<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Micro Mobile</title>
</head>
<body style="text-align:center; padding:2rem; font-family:sans-serif;">
  <h2>Test reconnaissance vocale mobile</h2>
  <button id="btn">DÃ©marrer (parle aprÃ¨s clic)</button>
  <p id="status">â€”</p>
  <p id="result">RÃ©sultat : â€”</p>

  <script>
    const btn = document.getElementById('btn');
    const status = document.getElementById('status');
    const result = document.getElementById('result');

    const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!Speech) {
      status.textContent = "âŒ API non supportÃ©e sur ce navigateur/mobile";
      btn.disabled = true;
      return;
    }

    const rec = new Speech();
    rec.lang = 'ja-JP';           // essaie aussi 'fr-FR' ou 'en-US' pour tester
    rec.interimResults = false;
    rec.maxAlternatives = 1;

    btn.onclick = () => {
      status.textContent = "Initialisation...";
      btn.disabled = true;
      btn.textContent = "Ã‰coute...";

      try {
        rec.start();
        status.textContent = "ðŸŽ¤ Ã‰coute en cours ! Parle maintenant (5-10s max)";
      } catch(e) {
        status.textContent = "Erreur immÃ©diate : " + e.message;
        btn.disabled = false;
      }
    };

    rec.onstart = () => {
      status.textContent = "â†’ Microphone actif !";
    };

    rec.onresult = (e) => {
      const texte = e.results[0][0].transcript;
      result.textContent = "Entendu : " + texte;
      status.textContent = "OK !";
    };

    rec.onerror = (e) => {
      status.textContent = "âŒ Erreur : " + e.error;
      console.error(e);
      btn.disabled = false;
      btn.textContent = "DÃ©marrer";
    };

    rec.onend = () => {
      status.textContent = "Ã‰coute terminÃ©e";
      btn.disabled = false;
      btn.textContent = "DÃ©marrer";
    };
  </script>
</body>
</html>
