<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>G√©n√©rateur Voyelles Audio - Mobile</title>

<style>
body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background:#f5f5f5;
    margin:0;
    padding:10px;
}

.container {
    background:white;
    padding:20px;
    border-radius:12px;
    box-shadow:0 3px 10px rgba(0,0,0,0.1);
}

h1 {
    text-align:center;
}

button {
    width:100%;
    padding:15px;
    margin:8px 0;
    font-size:16px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    background:#4CAF50;
    color:white;
}

button:disabled {
    background:#aaa;
}

.progress {
    margin-top:15px;
    background:#eee;
    border-radius:10px;
    overflow:hidden;
}

.bar {
    height:24px;
    background:linear-gradient(90deg,#4CAF50,#8BC34A);
    width:0%;
    transition:.2s;
}

.log {
    margin-top:10px;
    background:#111;
    color:#0f0;
    font-family:monospace;
    font-size:12px;
    max-height:260px;
    overflow-y:auto;
    padding:8px;
    border-radius:8px;
}
</style>
</head>

<body>
<div class="container">
<h1>üéôÔ∏è Dataset Voyelles Mobile</h1>

<p>
150 fichiers audio g√©n√©r√©s automatiquement.<br>
Fonctionne directement sur t√©l√©phone Android.
</p>

<button id="startBtn" onclick="start()">üöÄ D√©marrer la g√©n√©ration</button>
<button onclick="testVoice()" style="background:#2196F3;">üîä Tester voix</button>

<div class="progress"><div class="bar" id="bar"></div></div>
<div class="log" id="log"></div>

</div>

<script>
const voyelles = ['A','√â','I','O','U'];
const total = 150;
let count = 0;
let voices = [];

speechSynthesis.onvoiceschanged = () => {
    voices = speechSynthesis.getVoices().filter(v=>v.lang.startsWith("fr"));
    log(`Voix d√©tect√©es : ${voices.length}`);
};

function log(txt){
    const l=document.getElementById("log");
    l.innerHTML+=`<div>${new Date().toLocaleTimeString()} ‚Äî ${txt}</div>`;
    l.scrollTop=l.scrollHeight;
}

function progress(){
    document.getElementById("bar").style.width=(count/total*100)+"%";
}

async function captureAndSpeak(text, pitch, rate, filename){

    const stream = await navigator.mediaDevices.getDisplayMedia({
        video:false,
        audio:true
    });

    const recorder = new MediaRecorder(stream);
    const chunks=[];

    recorder.ondataavailable=e=>chunks.push(e.data);

    recorder.onstop=()=>{
        const blob=new Blob(chunks,{type:'audio/webm'});
        const url=URL.createObjectURL(blob);
        const a=document.createElement("a");
        a.href=url;
        a.download=filename;
        a.click();
        URL.revokeObjectURL(url);
    };

    recorder.start();

    const u=new SpeechSynthesisUtterance(text);
    u.voice=voices[Math.floor(Math.random()*voices.length)];
    u.pitch=pitch;
    u.rate=rate;

    speechSynthesis.speak(u);

    u.onend=()=>setTimeout(()=>recorder.stop(),150);

    await new Promise(r=>u.onend=r);
}

async function start(){

    if(!voices.length){
        alert("Voix non charg√©es");
        return;
    }

    document.getElementById("startBtn").disabled=true;
    count=0;
    log("D√©marrage g√©n√©ration...");
    progress();

    for(const v of voyelles){

        for(let i=0;i<30;i++){

            const pitch=1+(Math.random()*0.6-0.3);
            const rate=1+(Math.random()*0.6-0.3);

            const name=`${v}_${i+1}_p${pitch.toFixed(2)}_r${rate.toFixed(2)}.webm`;

            log(`G√©n√©ration ${name}`);

            await captureAndSpeak(v,pitch,rate,name);

            count++;
            progress();

            await new Promise(r=>setTimeout(r,300));
        }
    }

    log("üéâ G√©n√©ration termin√©e !");
    alert("150 fichiers audio g√©n√©r√©s !");
    document.getElementById("startBtn").disabled=false;
}

function testVoice(){
    const u=new SpeechSynthesisUtterance("A √â I O U");
    u.voice=voices[0];
    speechSynthesis.speak(u);
}
</script>
</body>
</html>
